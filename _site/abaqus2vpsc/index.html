<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>FE deformation history for texture simulations &#8211; research blog</title>
<meta name="description" content="The post explains how to obtain local deformation history from ABAQUS simulation of a deformation process for simulating the corresponding texture evolution by VPSC.">
<meta name="keywords" content="vpsc, abaqus, python">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="FE deformation history for texture simulations">
<meta property="og:description" content="The post explains how to obtain local deformation history from ABAQUS simulation of a deformation process for simulating the corresponding texture evolution by VPSC.">
<meta property="og:url" content="/abaqus2vpsc/">
<meta property="og:site_name" content="research blog">





<link rel="canonical" href="/abaqus2vpsc/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="research blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">The author</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="Marat I. Latypov photo" class="author-photo">
					<h4>Marat I. Latypov</h4>
					<p>Materials Scientist at Georgia Tech Lorraine.</p>
				</li>
				<li><a href="/about"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:marat.latypov@georgiatech-metz.fr"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				
				
				
				<li>
					<a href="https://linkedin.com/in/latmarat"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				
				
				
				
				
				<li>
					<a href="https://www.researchgate.net/profile/Marat_Latypov"><i class="ai ai-researchgate"></i> ResearchGate</a>
				</li>
					<li>
					<a href="https://scholar.google.com/citations?user=
					We5aJywAAAAJ&hl=en&oi=ao"><i class="ai ai-google-scholar"></i> Google Scholar</a>
				</li>
			</ul><!-- /.dl-submenu -->
		</li>
		<li><a href="/posts/">All Posts</a></li>
		<li><a href="/tags/">All Tags</a></li>
		
	    
	    <li><a href="/about/" >About</a></li>
	  
	    
	    <li><a href="/portfolio/" >Portfolio</a></li>
	  
	    
	    <li><a href="http://latmarat.net" target="_blank">Landing Page</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/abaqus2vpsc/" rel="bookmark" title="FE deformation history for texture simulations">FE deformation history for texture simulations</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-08-03T00:00:00+02:00">August 03, 2015</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~6 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>The post explains how to obtain local deformation history from ABAQUS finite element simulation of a deformation process for modeling of the corresponding texture evolution by VPSC.</p>

<h1 id="intro">Intro</h1>

<p>Simulations of texture evolution during simple monotonic loading (e.g. uniaxial tension, compression) can be readily performed with the stand-alone VPSC code. However, it is frequently desired to analyze texture evolution during complex <em>non-monotonic</em> deformation: for example, local texture evolution in a region of the sample during metal forming. In such cases, deformation histories can be obtained from finite element simulations. The present post describes a framework (inspired by <a href="http://dx.doi.org/10.1016/j.actamat.2004.06.042"><em>Li et al., 2004</em></a>) for obtaining local deformation histories from ABAQUS simulations of a deformation process in a format readable by VPSC. The calculation of the velocity gradient tensor needed for VPSC simulations is implemented in a user material subroutine (UMAT), whereas post-processing of the results and writing it to an output text file is performed with the aid of ABAQUS Python scripting.</p>

<h1 id="algorithm">Algorithm</h1>

<p>For an ABAQUS/Standard simulation of a metal forming process with a simple and widely used J2 plasticity model and isotropic hardening, local deformation history can be obtained in the following steps.</p>

<ol>
  <li>Download <a href="https://github.com/latmarat/abaqus2vpsc/archive/master.zip">my abaqus2vpsc.zip package</a> containing the UMAT subroutine file (<code class="highlighter-rouge">j2isoVelOut.for</code>) and the Python script (<code class="highlighter-rouge">abaqus2vpsc.py</code>) for post-processing and extract it to a convenient location.</li>
  <li>Create an ABAQUS/Standard model of the deformation process of interest as usual (create and mesh parts, define boundary conditions and interactions, etc.) with the following peculiarities:
    <ul>
      <li><strong>Material.</strong> Create a user material with 22 solution-dependent variables (SDVs) and list Young modulus, Poisson ratio, and stress–strain data in <em>Mechanical Constants</em> table.</li>
      <li><strong>Field Output.</strong> Request field output for SDVs in the deformable part of interest with a a reasonable frequency that will guarantee sufficiently small time increment in the VPSC simulation.</li>
      <li><strong>UMAT file.</strong> Upon job creation, point to the UMAT subroutine file <a href="https://github.com/latmarat/abaqus2vpsc/blob/master/j2isoVelGradOut.for"><code class="highlighter-rouge">j2isoVelOut.for</code></a>, which includes calculation of the velocity gradient tensor.</li>
    </ul>
  </li>
  <li>Run the ABAQUS/Standard simulation and make sure it is successfully completed.</li>
  <li>Get the label of the element for which local texture evolution (and thus the deformation history) is of interest.</li>
  <li>Run the Python script <a href="https://github.com/latmarat/abaqus2vpsc/blob/master/abaqus2vpsc.py"><code class="highlighter-rouge">abaqus2vpsc.py</code></a> from ABAQUS/CAE or command line, which will extract the components of the velocity gradient for the element of interest and write them to a text file.</li>
</ol>

<p>Below are some details on these steps assuming usage of ABAQUS/CAE.</p>

<h2 id="creating-user-material">Creating user material</h2>
<ol>
  <li>Create a new material, giving it a meaningful name.</li>
  <li>Go to <em>General</em> -&gt; <em>User Material</em> and list consequently elastic modulus, Poisson ratio, and flow stress–plastic strain pairs.
 <img src="https://farm1.staticflickr.com/318/20247850946_bd5bdd895a_o_d.png" alt="Creating u4ser material" /></li>
  <li>Go to <em>General</em> -&gt; <em>Depvar</em> and set <em>Number of solution-dependent variables</em> to 22.
 <img src="https://farm1.staticflickr.com/471/20274076485_6da5872b1c_o_d.png" alt="Creating u4ser material" /></li>
</ol>

<p class="notice"><strong>Tip</strong>: entry of stress–strain pairs to Mechanical Constants table might be really tedious when the number of data points is large. If you already have a “normally” defined material in your model tree, you may use <a href="https://github.com/latmarat/abaqus2vpsc/blob/master/elasplas2umat.py"><code class="highlighter-rouge">elasplas2umat.py</code></a> utility script (coming with <code class="highlighter-rouge">abaqus2vpsc.zip</code> package), which will transfer elastic and plastic properties from conventionally defined material to the Mechanical Constants of the user material.</p>

<h2 id="running-abaqus-simulation">Running ABAQUS simulation</h2>

<p>After finalizing the finite element model, create a job and specify the path to <code class="highlighter-rouge">j2isoVelOut.for</code> in <em>User subroutine file</em> field in <em>General</em> tab of <em>Edit job</em> window. After pointing to the UMAT file, the job is ready for submission.</p>

<h2 id="identifying-the-element-of-interest">Identifying the element of interest</h2>

<p>The Python script, which reads the components of the velocity gradient tensor from the ABAQUS output database (odb file), requires the label of the element for which the deformation history is needed. The label of the element can be found in the Mesh module of ABAQUS/CAE:</p>

<ol>
  <li>Go to <em>Mesh</em> module.</li>
  <li>Go to <em>Tools</em> -&gt; <em>Query</em> and choose <em>Element</em></li>
  <li>Pick the element for which local deformation history is needed</li>
  <li>Read the label of the element of interest in the message area of ABAQUS window.</li>
</ol>

<p><img src="https://farm1.staticflickr.com/330/20173661438_3ce701e827_o_d.png" alt="get-elem-label" />
Illustration of how to get the element label of interest in ABAQUS/CAE.</p>

<h2 id="post-processing">Post-processing</h2>

<p>After running the simulation as described above, the components of the velocity gradient tensor can be accessed in the output database (odb file) as state variables (SDV). While it is possible to manually export these variables to a text file for subsequent use in VPSC, a <a href="https://github.com/latmarat/abaqus2vpsc/blob/master/abaqus2vpsc.py">Python script</a> was developed for extracting the evolution of the velocity gradient with ease and in the right format for VPSC.</p>

<p>To run the script, open ABAQUS/CAE and</p>

<ol>
  <li>Go to <em>File</em> -&gt; <em>Run Script…</em>, navigate to <code class="highlighter-rouge">abaqus2vpsc.py</code> file contained in the downloaded <code class="highlighter-rouge">abaqus2vpsc.zip</code> package.</li>
  <li>In the appeared window for input, specify
    <ul>
      <li>the full path to the odb (e.g. <em>C:\Temp\rolling.odb</em>)</li>
      <li>Instance name of the deformable sample (e.g. <em>PART-1</em>)</li>
      <li>Element Number (or label) identified as described in the previous subsection</li>
    </ul>
  </li>
  <li>Check run-time messages of the script in the message area of ABAQUS/CAE. Particularly, check if <em>Step</em>, <em>Instance</em>, and <em>Element number</em> are correct. If the script completed successfully, the final message should be <em>‘Deformation history for VPSC is written to file</em> same-path-as-odb\FE-Lij_hist.dat <em>’</em> (see figure below).</li>
</ol>

<p>Running <code class="highlighter-rouge">abaqus2vpsc.py</code> script from ABAQUS/CAE with an example of filling the required fields.
<img src="https://farm1.staticflickr.com/369/20368112281_be0f0dd678_o_d.png" alt="abaqus2vpsc.py script" /></p>

<p>As a result of running the script, the resulting file <em>FE-Lij_hist.dat</em> will contain a heading, steps, and the components of the velocity gradient in the format required by VPSC. This file can be readily used for VPSC simulations of the local texture evolution corresponding to the obtained local deformation history.</p>

<h2 id="running-vpsc-simulation">Running VPSC simulation</h2>

<p>Refer to the <a href="http://public.lanl.gov/lebenso/VPSC7c_manual.pdf">VPSC manual</a> on how to run a VPSC simulation of texture evolution for a given evolution of the velocity gradient tensor (especially Example 2, case B).</p>

<h1 id="appendix-calculation-of-l-tensor-in-umat">Appendix: Calculation of <strong>L</strong> tensor in UMAT</h1>

<p>For texture simulations for non-uniform deformation, VPSC requires the evolution of velocity gradient tensor, <script type="math/tex">\mathbf{L}</script>. Since the velocity gradient tensor is not calculated in ABAQUS by default, its calculation has to be implemented in a user subroutine.</p>

<h2 id="why-umat">Why UMAT?</h2>

<p>In the current framework, the calculation of the velocity gradient is implemented in UMAT subroutine for the following reasons:</p>

<ul>
  <li>To UMAT, ABAQUS passes deformation gradient tensor, <script type="math/tex">\mathbf{F}</script>, from which the velocity gradient tensor can be readily calculated.</li>
  <li>UMAT allows for storing custom quantities (velocity gradient components in our case) in an array of state variables (or solution-dependent variables, SDVs), which are then accessible in the output database.</li>
</ul>

<p>Furthermore, the main purpose of UMAT is to implement a custom constitutive model of the material so that the current framework can be used with a wide range of user-defined material models.</p>

<h2 id="calculation-of-the-velocity-gradient-tensor">Calculation of the velocity gradient tensor</h2>

<p>The velocity gradient tensor, <script type="math/tex">\mathbf{L}</script>, can be derived from the deformation gradient, <script type="math/tex">\mathbf{F}</script>, passed to UMAT as follows (<a href="http://dx.doi.org/10.1016/j.actamat.2004.06.042">Li et al., 2004</a>)</p>

<script type="math/tex; mode=display">\mathbf{L} = \frac{\mathbf{F}_{\tau}\mathbf{F}^{-1}_{t}-\mathbf{I}}{\Delta t}</script>

<p>where <script type="math/tex">\mathbf{F}_{t}</script> and <script type="math/tex">{\mathbf{F}}_{\tau}</script> are the deformation gradient tensors at the beginning and end of the time increment, <script type="math/tex">\Delta t</script> is the time increment, and <script type="math/tex">\mathbf{I}</script> is the identity tensor.</p>

<p>To implement the above equation in UMAT, we first calculate the inverse of the deformation gradient at the beginning of the time increment, <script type="math/tex">\mathbf{F}_{t}</script>, which is passed to UMAT as <code class="highlighter-rouge">DFGRD0</code>. To keep the main UMAT subroutine neat, we shall define and use a custom subroutine <code class="highlighter-rouge">M3INV</code> for calculation of the inverse of a 3x3 matrix:</p>

<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran">CALL M3INV(DFGRD0,FTINV)</code></pre></figure>

<p>which results in that the inverse of the deformation gradient <script type="math/tex">\mathbf{F}^{-1}_{t}</script> is stored in <code class="highlighter-rouge">FTINV</code> array.</p>

<p>We then calculate the product <script type="math/tex">{\mathbf{F}}_{\tau}{\mathbf{F}}^{-1}_{t}</script>, again using a custom subroutine <code class="highlighter-rouge">MPROD</code>.</p>

<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran">CALL MPROD(DFGRD1,FTINV,AUX)</code></pre></figure>

<p>With the product <script type="math/tex">{\mathbf{F}}_{\tau}{\mathbf{F}}^{-1}_{t}</script> being stored in an array <code class="highlighter-rouge">AUX</code>, we can finally calculate the velocity gradient tensor, <script type="math/tex">\mathbf{L}</script>, with the following snippet:</p>

<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran">DO 231 I=1,3
	DO 231 J=1,3
		VELGRD(I,J) = (AUX(I,J)-ONEMAT(I,J))/DTIME
231   CONTINUE</code></pre></figure>

<p>To make the velocity gradient tensor accessible in the output database, we store <script type="math/tex">L_{ij}</script> components to the array of state variables, or SDV, as (starting from index 14 because elements of <code class="highlighter-rouge">STATEV</code> with smaller indices are already in use for the constitutive model)</p>

<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran">STATEV(14) = VELGRD(1,1)
STATEV(15) = VELGRD(1,2)
STATEV(16) = VELGRD(1,3)
STATEV(17) = VELGRD(2,1)
STATEV(18) = VELGRD(2,2)
STATEV(19) = VELGRD(2,3)
STATEV(20) = VELGRD(3,1)
STATEV(21) = VELGRD(3,2)
STATEV(22) = VELGRD(3,3)  </code></pre></figure>

<p>The code snippets presented above result in that, with proper field output request, the components of the velocity gradient tensor are accessible in the output database of the ABAQUS simulation.  The calculation presented above can be incorporated into any UMAT subroutine for any material model as the computation requires only deformation gradient, which is always passed to UMAT by ABAQUS. Incorporation of the described computations in a UMAT subroutine requires care with the allocation of arrays (<code class="highlighter-rouge">VELGRD</code> <code class="highlighter-rouge">FTINV</code>, etc.). The <a href="https://github.com/latmarat/abaqus2vpsc/blob/master/j2isoVelGradOut.for">example UMAT</a> described in this post can be used as a reference for the right allocation of arrays. The utility subroutines <code class="highlighter-rouge">M3INV</code>, <code class="highlighter-rouge">MPROD</code> are also given there.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#vpsc" title="Pages tagged vpsc" class="tag"><span class="term">vpsc</span></a><a href="/tags/#abaqus" title="Pages tagged abaqus" class="tag"><span class="term">abaqus</span></a><a href="/tags/#python" title="Pages tagged python" class="tag"><span class="term">python</span></a></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2015-08-03">August 03, 2015</time></span></span>
        <span class="author vcard"><span class="fn">Marat I. Latypov</span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/vpsc-mtex/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/emi-info/" title="My talk on quantification of EBSD datasets">My talk on quantification of EBSD datasets</a></h3>
      <p>Slides presented at EMI-2016 conference (Metz, France), October 2016. <a href="/emi-info/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/slides/emi-slides/" title="EBSD data analytics for quantification of UFG microstructures">EBSD data analytics for quantification of UFG microstructures</a></h4>
        <span>Published on November 14, 2016</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="/ppt2reveal/" title="How to make an easy transition from PowerPoint to reveal.js">How to make an easy transition from PowerPoint to reveal.js</a></h4>
        <span>Published on August 26, 2016</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Marat I. Latypov. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61278008-2', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'latmarat'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</body>
</html>
