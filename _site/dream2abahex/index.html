<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>ABAQUS hexahedral mesh and grain orientations from Dream.3D &#8211; research blog</title>
<meta name="description" content="The post describes a MATLAB script for writing ABAQUS hexahedral finite element mesh and Euler angles from synthetic microstructures generated in Dream.3D.">
<meta name="keywords" content="dream.3d, abaqus, matlab">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="ABAQUS hexahedral mesh and grain orientations from Dream.3D">
<meta property="og:description" content="The post describes a MATLAB script for writing ABAQUS hexahedral finite element mesh and Euler angles from synthetic microstructures generated in Dream.3D.">
<meta property="og:url" content="/dream2abahex/">
<meta property="og:site_name" content="research blog">





<link rel="canonical" href="/dream2abahex/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="research blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">The author</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="Marat I. Latypov photo" class="author-photo">
					<h4>Marat I. Latypov</h4>
					<p>Materials Scientist at Georgia Tech Lorraine.</p>
				</li>
				<li><a href="/about"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:marat.latypov@georgiatech-metz.fr"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				
				
				
				<li>
					<a href="https://linkedin.com/in/latmarat"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				
				
				
				
				
				<li>
					<a href="https://www.researchgate.net/profile/Marat_Latypov"><i class="ai ai-researchgate"></i> ResearchGate</a>
				</li>
					<li>
					<a href="https://scholar.google.com/citations?user=
					We5aJywAAAAJ&hl=en&oi=ao"><i class="ai ai-google-scholar"></i> Google Scholar</a>
				</li>
			</ul><!-- /.dl-submenu -->
		</li>
		<li><a href="/posts/">All Posts</a></li>
		<li><a href="/tags/">All Tags</a></li>
		
	    
	    <li><a href="/about/" >About</a></li>
	  
	    
	    <li><a href="/portfolio/" >Portfolio</a></li>
	  
	    
	    <li><a href="http://latmarat.net" target="_blank">Landing Page</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/dream2abahex/" rel="bookmark" title="ABAQUS hexahedral mesh and grain orientations from Dream.3D">ABAQUS hexahedral mesh and grain orientations from Dream.3D</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-10-19T00:00:00+02:00">October 19, 2015</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~4 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>The post describes a MATLAB script for writing ABAQUS hexahedral finite element mesh and Euler angles from synthetic microstructures generated in Dream.3D.</p>

<h1 id="intro">Intro</h1>

<p>One of the great features of <a href="http://dream3d.bluequartz.net">Dream.3D</a> is the generation of synthetic microstructures. It allows for virtual experiments with 3D microstructures as well as for studying the effects of various microstructural features on the full-field stress–strain distributions or effective mechanical characteristics of representative volume elements.</p>

<p>To facilitate such micromechanical studies, Dream.3D (starting from ver. 6.1.77) <a href="http://dream3d.bluequartz.net/?p=481">introduced</a> a filter called <em>Abaqus Hexahedron Writer</em>, which writes a set of ABAQUS input files containing a mesh of eight-node brick elements grouped in Element Sets (and Sections for assignment of material properties) that represent grains (“Features” in Dream.3D terminology).</p>

<p>Until now, however, <em>Abaqus Hexahedron Writer</em>  filter does not allow for export of grain orientations along with the ABAQUS input files. This post describes a work-around for writing grain orientations to a text file in addition to ABAQUS hexahedral mesh.</p>

<h1 id="workflow">Workflow</h1>

<p>The workflow suggested here is very simple:</p>

<ol>
  <li>Generate your synthetic microstructure in Dream.3D</li>
  <li>Write microstructure information as a grid of voxels to a text file (<em>Write Los Alamos FFT file</em> filter)</li>
  <li>Use my <code class="highlighter-rouge">dream2abahex</code> MATLAB script to write mesh file and grain orientations file based on the information in the Los Alamos FFT file.</li>
</ol>

<p>At the core of this work-around is a custom MATLAB script called <a href="https://github.com/latmarat/dream3d-converters/blob/master/dream2abahex.m"><code class="highlighter-rouge">dream2abahex</code></a>. This script writes coordinates of eight nodes around each voxel in the Los Alamos FFT grid and writes instructions how these nodes should be connected to form eight-node brick (C3D8) elements. Furthermore, the script preserves the information about grain IDs using Element Sets and phase IDs using both Element Sets and Sections. The choice to pass <em>phases</em> (rather than grains) as Sections is associated with the expectation that material properties will vary from phase to phase rather than from grain to grain.</p>

<p class="notice"><strong>Tip</strong>: it is quite straightforward to change this choice if your user material subroutine supposes that material properties differ from grain to grain and thus requires an individual Section for each grain.</p>

<p>Finally, and most importantly, the script writes Euler angles (which were read from the FFT file) for each element as a look-up table to a new text file. These orientations can be read from FORTRAN user subroutine defining the behavior of the material (e.g. UMAT).</p>

<p class="notice"><strong>Tip</strong>: as a bonus, the script creates Sets of nodes laying on all 6 faces of the representative volume so that Boundary Conditions can be readily defined on these nodes. Created Node Sets are named according to the face normals, e.g. nodes laying on the face whose normal is +X are contained in Node Set called “NODES+1”, nodes laying on the face whose normal is -Z is contained in “NODES-3”, etc.</p>

<h1 id="usage">Usage</h1>

<p><a href="https://github.com/latmarat/dream3d-converters/blob/master/dream2abahex.m">Download</a> <code class="highlighter-rouge">dream2abahex</code> script from GitHub, place it to a folder known to MATLAB and run</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">dream2abahex</span><span class="p">(</span><span class="s1">'path/to/fft/micro.vox'</span><span class="p">,</span> <span class="s1">'desired/path/to/abaqus/file/aba.inp'</span><span class="p">)</span></code></pre></figure>

<p>This function call will result in creating a file <strong>aba.inp</strong> containing the mesh and <strong>aba.tex</strong> containing the orientations of each element.</p>

<h1 id="example">Example</h1>

<p>Let’s generate a synthetic microstructure using statistics for a two-phase microstructure consisting of a primary phase and second-phase particles. For this purpose, we can use a prebuilt pipeline called <em>Two Phase Cubic Hexagonal Particles Equiaxed</em> (comes with Dream.3D ver. 6.2.0) that uses statistics file <code class="highlighter-rouge">TwoPhaseCubicHexParticlesEquiaxed.dream3d</code>. To this pipeline, we shall only add <em>Write Los Alamos FFT file</em> filter to write the voxel file (e.g. <code class="highlighter-rouge">2ph_64x64x64.vox</code>) from which we will create our mesh.</p>

<p>After the pipeline is successfully completed, we run the MATLAB script pointing to our Los Alamos FFT grid file and giving a name for ABAQUS input file by the following command</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">dream2abahex</span><span class="p">(</span><span class="s1">'2ph_64x64x64.vox'</span><span class="p">,</span> <span class="s1">'2ph_64x64x64.inp'</span><span class="p">)</span></code></pre></figure>

<p class="notice"><strong>Tip</strong>: if <code class="highlighter-rouge">2ph_64x64x64.vox</code> is not in MATLAB path, use the full path of the grid file, e.g. <em>`C:\Users\UserName\Documents\2ph_64x64x64.vox’</em> as input to the function. Full path can also be used for the resulting mesh file. File with Euler angles will always be written to the same folder as the mesh file and will have the same name with extension .tex</p>

<p>As a result, we obtain an ABAQUS input file (<code class="highlighter-rouge">2ph_64x64x64.inp</code>) containing a C3D8 (brick) mesh with grains saved as Element Sets and phases saved as both Sets and Sections. In addition, we get a text file (<code class="highlighter-rouge">2ph_64x64x64.tex</code>) with grain orientations (represented by Bunge Euler angles) for each element in the mesh with orientations sorted according to the element label. An example of the contents of the file with grain orientations is below</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Euler angle sets (phi1, Phi, phi2) for C3D8 mesh in 2ph_64x64x64.inp</span>
<span class="c"># Euler angle sets are sorted according to element labels</span>
<span class="c"># 1 element in mesh - 1 set of Euler angles. Generated by dream2abahex.m</span>
<span class="n">B</span>	<span class="mi">262144</span>
      <span class="mf">17.0020</span>     <span class="mf">115.9040</span>    <span class="o">-</span><span class="mf">108.5220</span>    <span class="c"># -----&gt; for element 1</span>
      <span class="mf">17.0020</span>     <span class="mf">115.9040</span>    <span class="o">-</span><span class="mf">108.5220</span>    <span class="c"># -----&gt; for element 2</span>
	<span class="o">....</span>
    <span class="o">-</span><span class="mf">105.7370</span>      <span class="mf">51.4060</span>    <span class="o">-</span><span class="mf">151.4460</span>    <span class="c"># -----&gt; for element n</span>
    <span class="o">-</span><span class="mf">105.7370</span>      <span class="mf">51.4060</span>    <span class="o">-</span><span class="mf">151.4460</span>    <span class="c"># -----&gt; for element ...</span>
    <span class="o">-</span><span class="mf">105.7370</span>      <span class="mf">51.4060</span>    <span class="o">-</span><span class="mf">151.4460</span>    <span class="c"># -----&gt; for element 262144</span></code></pre></figure>

<p>It is seen that the orientation file has three information lines followed by a line containing Euler angles convention (B is for Bunge) and the total number of orientations in the file. Then, there are sets of three float numbers correponding to the three Euler angles – <script type="math/tex">\phi_{1}</script>, <script type="math/tex">\Phi</script>, <script type="math/tex">\phi_{2}</script>.</p>

<p>Now let’s check if the Sections and Element Sets correctly represent the original phases and grains.</p>

<p>Below is the comparison between the original phase IDs from dream3d file and the sections in the generated mesh.</p>

<p><img src="https://farm6.staticflickr.com/5822/21680572513_8eec239e12_o_d.png" alt="Comparison of phases" /></p>

<p>The distribution of phases looks identical in both figures. Next we compare the original grain IDs in dream3d file and Element Sets in the generated mesh.</p>

<p><img src="https://farm6.staticflickr.com/5833/21680572773_dd4f49e150_o_d.png" alt="Comparison of grains" /></p>

<p>Looks alright.</p>

<p>As a final note, we should remember that the phases are passed to the ABAQUS model as Sections with assigned properties and they suppose that the model will contain the same number of Materials. Therefore, Materials named <strong>‘Phase-1’</strong>, <strong>‘Phase-2’</strong>, etc. must be defined for running the simulation.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#dream.3d" title="Pages tagged dream.3d" class="tag"><span class="term">dream.3d</span></a><a href="/tags/#abaqus" title="Pages tagged abaqus" class="tag"><span class="term">abaqus</span></a><a href="/tags/#matlab" title="Pages tagged matlab" class="tag"><span class="term">matlab</span></a></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2015-10-19">October 19, 2015</time></span></span>
        <span class="author vcard"><span class="fn">Marat I. Latypov</span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/abaqus2vpsc/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/emi-info/" title="My talk on quantification of EBSD datasets">My talk on quantification of EBSD datasets</a></h3>
      <p>Slides presented at EMI-2016 conference (Metz, France), October 2016. <a href="/emi-info/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/slides/emi-slides/" title="EBSD data analytics for quantification of UFG microstructures">EBSD data analytics for quantification of UFG microstructures</a></h4>
        <span>Published on November 14, 2016</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="/ppt2reveal/" title="How to make an easy transition from PowerPoint to reveal.js">How to make an easy transition from PowerPoint to reveal.js</a></h4>
        <span>Published on August 26, 2016</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Marat I. Latypov. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61278008-2', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'latmarat'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</body>
</html>
