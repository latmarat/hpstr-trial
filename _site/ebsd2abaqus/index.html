<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>ABAQUS mesh from EBSD using MTEX &#8211; research blog</title>
<meta name="description" content="The post describes a framework for generation of ABAQUS finite element mesh from experimental EBSD maps using MTEX toolbox in MATLAB.">
<meta name="keywords" content="mtex, abaqus, matlab, ebsd, microstructures">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="ABAQUS mesh from EBSD using MTEX">
<meta property="og:description" content="The post describes a framework for generation of ABAQUS finite element mesh from experimental EBSD maps using MTEX toolbox in MATLAB.">
<meta property="og:url" content="/ebsd2abaqus/">
<meta property="og:site_name" content="research blog">





<link rel="canonical" href="/ebsd2abaqus/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="research blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">The author</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="Marat I. Latypov photo" class="author-photo">
					<h4>Marat I. Latypov</h4>
					<p>Materials Scientist at Georgia Tech Lorraine.</p>
				</li>
				<li><a href="/about"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:marat.latypov@georgiatech-metz.fr"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				
				
				
				<li>
					<a href="https://linkedin.com/in/latmarat"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				
				
				
				
				
				<li>
					<a href="https://www.researchgate.net/profile/Marat_Latypov"><i class="ai ai-researchgate"></i> ResearchGate</a>
				</li>
					<li>
					<a href="https://scholar.google.com/citations?user=
					We5aJywAAAAJ&hl=en&oi=ao"><i class="ai ai-google-scholar"></i> Google Scholar</a>
				</li>
			</ul><!-- /.dl-submenu -->
		</li>
		<li><a href="/posts/">All Posts</a></li>
		<li><a href="/tags/">All Tags</a></li>
		
	    
	    <li><a href="/about/" >About</a></li>
	  
	    
	    <li><a href="/portfolio/" >Portfolio</a></li>
	  
	    
	    <li><a href="http://latmarat.net" target="_blank">Landing Page</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  
  <div class="entry-image">
    <img src="https://farm9.staticflickr.com/8847/28162519202_99f7592b70_b_d.jpg" alt="ABAQUS mesh from EBSD using MTEX">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/ebsd2abaqus/" rel="bookmark" title="ABAQUS mesh from EBSD using MTEX">ABAQUS mesh from EBSD using MTEX</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2016-07-12T00:00:00+02:00">July 12, 2016</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~10 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>This article describes a procedure for generating ABAQUS finite element mesh from experimental EBSD maps using MTEX toolbox in MATLAB.</p>

<h1 id="introduction">Introduction</h1>

<p>It is sometimes desired to perform micromechanical finite element (FE) analysis of deformation of microstructures based on experimentally measured EBSD maps. The present post describes MATLAB scripts developed for automatic generation of FE mesh for a given EBSD map. The script is easy to use and requires minimal knowledge of coding in MATLAB.</p>

<p>To use the framework described here, you will need</p>

<ul>
  <li>MATLAB</li>
  <li><a href="http://mtex-toolbox.github.io/">MTEX toolbox</a></li>
  <li>ebsd2abaqus script (available on GitHub <a href="https://github.com/latmarat/ebsd2abaqus/blob/master/ebsd2abaqus.m">here</a>)</li>
</ul>

<h1 id="mesh-generation">Mesh generation</h1>

<p>If you know how to use MTEX for EBSD analysis and have a clean EBSD map loaded into MATLAB that satisfies the following requirements:</p>

<ul>
  <li>square grid</li>
  <li>no missing pixels</li>
</ul>

<p>then <a href="https://github.com/latmarat/ebsd2abaqus/archive/master.zip">download</a> <code class="highlighter-rouge">ebsd2abaqus</code> script and generate the FE mesh with a single MATLAB command:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ebsd2abaqus</span><span class="p">(</span><span class="n">ebsd</span><span class="p">,</span><span class="nb">angle</span><span class="p">)</span></code></pre></figure>

<p>where <code class="highlighter-rouge">ebsd</code> is a MATLAB variable containing the 2D EBSD data of interest and <code class="highlighter-rouge">angle</code> is the disorientation angle for grain segmentation.</p>

<p>The script takes EBSD pixels to form hexahedral elements of type C3D8 and writes the node coordinates to <code class="highlighter-rouge">inp</code> file. Grains are passed to ABAQUS as Element Sets, phases are passed as Element Sets and Sections, which makes it easy to assign different properties to grains or phases. Nodes on each face of the mesh are also saved as Node Sets that can be used to prescribe boundary conditions. The script generates pseudo-2D mesh: the resulting mesh consists of 3D elements but has only <em>one</em> element in thickness (along <script type="math/tex">z</script> axis).</p>

<p>As a result of running the script, the mesh is written to <code class="highlighter-rouge">ebsd.inp</code> file. To work with the model, open <code class="highlighter-rouge">ebsd.inp</code> in ABAQUS/CAE by going File-Import-Model (or modify the input file directly in your favorite text editor). Define  ABAQUS materials for each phase and finalize the finite element model (Step, BCs, etc.) to run the simulations.</p>

<p>If you are new to MTEX and unsure how to process the EBSD data, read on the following sections, which will guide you through the steps that might be necessary for preparing the data and correct mesh generation, such as</p>

<ul>
  <li>EBSD data import</li>
  <li>conversion from hexagonal to square grid</li>
  <li>clean-up of inaccurate pixels</li>
  <li>filling missing pixels</li>
</ul>

<h1 id="ebsd-data-import">EBSD data import</h1>

<p>The current framework utilizes MTEX functions so that MTEX must be properly installed in MATLAB. MTEX is an open-source MATLAB toolbox for texture and EBSD analysis (available at  <a href="http://mtex-toolbox.github.io/">http://mtex-toolbox.github.io/</a>).</p>

<p>Once MTEX is installed, you need to import the EBSD data into MATLAB. If you have never used MTEX, the simplest way to import the data is through MTEX Import Wizard. Import Wizard can be started by typing <code class="highlighter-rouge">import_wizard</code> in MATLAB command window, which results in a window shown in the figure below.</p>

<figure>
	<a href="https://farm8.staticflickr.com/7293/27900130560_bc7f3a4321_z_d.jpg"><img src="https://farm8.staticflickr.com/7293/27900130560_bc7f3a4321_z_d.jpg" alt="Screen-shots of MTEX Import Wizard" /></a>
	<figcaption>Screen-shots of MTEX Import Wizard.</figcaption>
</figure>

<p>Go to <code class="highlighter-rouge">EBSD</code> tab and click <code class="highlighter-rouge">+</code>. Browse to your EBSD file and open it. Accept the default settings in several windows, choose <em>workspace variable</em> as the import method in Import Data window and push <code class="highlighter-rouge">Finish</code>. Now EBSD data is stored in a variable <code class="highlighter-rouge">ebsd</code>. Further data processing will be carried out on this variable.</p>

<h1 id="pre-processing">Pre-processing</h1>

<h2 id="grid-conversion">Grid conversion</h2>

<p>The present framework of building a FE model approximates microstructures by hexahedral mesh, i.e. mesh consisting of cuboidal (C3D8) elements. The use of a hexahedral mesh inevitably leads to ladder-like grain/phase boundaries, however, this is assumed to be a sufficiently good approximation for many cases, especially when the EBSD map has a relatively high resolution.</p>

<p>Building a hexahedral mesh is <em>much</em> easier if the EBSD data is on a square grid. Since experimental EBSD maps are frequently recorded on hexagonal grids, it is necessary to convert these maps to square grids. In MTEX conversion can be done by using <code class="highlighter-rouge">fill</code> function:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ebsd</span> <span class="o">=</span> <span class="nb">fill</span><span class="p">(</span><span class="n">ebsd</span><span class="p">)</span></code></pre></figure>

<p class="notice"><strong>Pro-tip</strong>: Although <code class="highlighter-rouge">fill(ebsd)</code> converts the grid, use this function with care and check if the data is not distorted. If the results of <code class="highlighter-rouge">fill</code> function are not satisfactory, you can also try converting grids in ang files prior to loading the data into MTEX with the aid Dream.3D software (available at  <a href="http://dream3d.bluequartz.net/">http://dream3d.bluequartz.net/</a>). Have a look at <em>Convert Hexagonal Grid Data to Square Grid Data</em> filter, which also allows for batch conversion of many files.</p>

<h2 id="clean-up">Clean-up</h2>

<p>Experimental EBSD maps often contain inaccurate pixels which are undesirable in the FE model to be generated. The following pixels can be considered as “undesirable”:</p>

<ul>
  <li>non-indexed pixels</li>
  <li>pixels with low confidence index (CI)</li>
  <li>pixels that belong to unreasonably tiny “grains” (which result in the presence of numerous  grains that consist of only one or two pixels)</li>
</ul>

<p>Non-indexed and low-quality pixels can be removed with the following lines:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ebsd</span><span class="p">(</span><span class="s1">'nonIndexed'</span><span class="p">)</span> <span class="o">=</span> <span class="p">[];</span>
<span class="n">ebsd</span><span class="p">(</span><span class="n">ebsd</span><span class="o">.</span><span class="n">ci</span> <span class="o">&lt;</span> <span class="n">minCI</span><span class="p">)</span> <span class="o">=</span> <span class="p">[];</span></code></pre></figure>

<p>where <code class="highlighter-rouge">minCI</code> is the threshold CI such as 0.1.</p>

<p>Getting rid of pixels that belong to unreasonably tiny “grains” require prior grain segmentation:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="p">[</span><span class="n">grains</span><span class="p">,</span><span class="n">ebsd</span><span class="o">.</span><span class="n">grainId</span><span class="p">,</span><span class="n">ebsd</span><span class="o">.</span><span class="n">mis2mean</span><span class="p">]</span> <span class="o">=</span> <span class="n">calcGrains</span><span class="p">(</span><span class="n">ebsd</span><span class="p">,</span><span class="s1">'angle'</span><span class="p">,</span><span class="nb">angle</span><span class="o">*</span><span class="n">degree</span><span class="p">);</span></code></pre></figure>

<p>with <code class="highlighter-rouge">angle</code> being the disorientation angle for thresholding grains (e.g. 15).</p>

<p>After grain segmentation, such “bad” pixels can be removed as follows:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">indSmallSize</span> <span class="o">=</span> <span class="n">grains</span><span class="o">.</span><span class="n">grainSize</span> <span class="o">&lt;</span> <span class="n">minSize</span><span class="p">;</span>
<span class="n">ebsd</span><span class="p">(</span><span class="n">grains</span><span class="p">(</span><span class="n">indSmallSize</span><span class="p">))</span> <span class="o">=</span> <span class="p">[];</span></code></pre></figure>

<h3 id="automating-the-clean-up">Automating the clean-up</h3>

<p>Since we are likely to do some clean-up routine over and over again, it is a good idea to put such routine to a separate function.</p>

<p>As an example, I organized my cleaning routine into a function called <code class="highlighter-rouge">clean4fem</code> (available on GitHub <a href="https://github.com/latmarat/ebsd2abaqus/blob/master/clean4fem.m">here</a>). This function excludes the “bad” pixels mentioned above – non-indexed, with low CI, and of tiny grains. In addition, the script fills the removed pixels with phase ID, grain ID, and orientations equal to those of the grain surrounding these removed pixels.</p>

<p>Finally, for control purposes, the script plots three maps: raw EBSD data, data with inaccurate pixels removed, and finally the cleaned map with filled pixels (see <strong>Example</strong> section).</p>

<p>Typical use of this function will be as follows:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ebsd</span> <span class="o">=</span> <span class="n">clean4fem</span><span class="p">(</span><span class="n">ebsd</span><span class="p">,</span><span class="n">minSize</span><span class="p">,</span><span class="n">minCI</span><span class="p">,</span><span class="nb">angle</span><span class="p">);</span></code></pre></figure>

<p>where <code class="highlighter-rouge">minSize</code> – is the size of the grain in pixels below which grains are considered unreasonable, <code class="highlighter-rouge">minCI</code> – min confidence index to keep, <code class="highlighter-rouge">angle</code> – disorientation angle for grain segmentation.</p>

<h2 id="crop">Crop</h2>

<p>Sometimes only a certain region of EBSD map is of interest for FE analysis. In such cases, EBSD maps can be cropped by logical indexing based on coordinates.</p>

<p>For example, if the EBSD map is 30 <script type="math/tex">\mu m</script> along <script type="math/tex">x</script> and 15 <script type="math/tex">\mu m</script> along <script type="math/tex">y</script> and suppose only one half (along <script type="math/tex">x</script>) of the map is of interest, the map can be cropped by the following commands:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ebsd</span> <span class="o">=</span> <span class="n">ebsd</span><span class="p">(</span><span class="n">ebsd</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">);</span></code></pre></figure>

<p>A more arbitrary region can be also cropped:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">region</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span> <span class="n">y0</span> <span class="n">dx</span> <span class="n">dy</span><span class="p">];</span>
<span class="n">condition</span> <span class="o">=</span> <span class="nb">inpolygon</span><span class="p">(</span><span class="n">ebsd</span><span class="p">,</span><span class="n">region</span><span class="p">);</span>
<span class="n">ebsd</span> <span class="o">=</span> <span class="n">ebsd</span><span class="p">(</span><span class="n">condition</span><span class="p">);</span></code></pre></figure>

<p>Refer to MTEX manual to learn more about <a href="http://mtex-toolbox.github.io/files/doc/EBSDModifyData.html#9">selecting a certain region</a>.</p>

<p class="notice"><strong>Pro-tip</strong>: it is a good idea to do cropping first of all because it will save a lot of computational cost: any processing is much faster on a smaller map!</p>

<h1 id="example">Example</h1>

<p>Let’s try the workflow described above on realistic EBSD data, for example, on <strong>Forsterite</strong> dataset pre-packaged with MTEX.</p>

<h3 id="loading-the-data">Loading the data</h3>

<p>To load the <strong>Forsterite</strong> dataset, simply run the following in MATLAB command line:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">mtexdata</span> <span class="n">forsterite</span></code></pre></figure>

<p>As a result of this command, the raw EBSD data is loaded into variable <code class="highlighter-rouge">ebsd</code>, whose visualization using</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="nb">plot</span><span class="p">(</span><span class="n">ebsd</span><span class="p">)</span></code></pre></figure>

<p>will look as shown below.</p>

<figure>
	<a href="https://farm8.staticflickr.com/7666/28178489705_262f82b54b_z_d.jpg"><img src="https://farm8.staticflickr.com/7666/28178489705_262f82b54b_z_d.jpg" alt="Raw EBSD map" /></a>
	<figcaption>Raw Forsterite EBSD map.</figcaption>
</figure>

<p>Here we can see a high-resolution map with several phases and many non-indexed pixels. A perfect dataset to test our framework!</p>

<h3 id="cropping-the-map">Cropping the map</h3>

<p>The loaded EBSD map has 245,952 pixels, which is a bit overwhelming for FE analysis so let’s crop the EBSD map, say, to a quarter of the original map along <script type="math/tex">x</script> axis and to a half along <script type="math/tex">y</script>:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ebsd</span> <span class="o">=</span> <span class="n">ebsd</span><span class="p">(</span><span class="n">ebsd</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">ebsd</span><span class="o">.</span><span class="n">x</span><span class="p">)/</span><span class="mi">4</span><span class="p">);</span>
<span class="n">ebsd</span> <span class="o">=</span> <span class="n">ebsd</span><span class="p">(</span><span class="n">ebsd</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ebsd</span><span class="o">.</span><span class="n">y</span><span class="p">)/</span><span class="mi">2</span><span class="p">);</span></code></pre></figure>

<h3 id="cleaning-up">Cleaning-up</h3>

<p>Now let’s clean our map using the mentioned helper function <code class="highlighter-rouge">clean4fem</code>, with the following settings:</p>

<ul>
  <li>minimum allowed quality: <code class="highlighter-rouge">mad = 0.1</code>;</li>
  <li>minimum allowed grain size: <code class="highlighter-rouge">5 px</code>;</li>
  <li>disorientation angle for grain segmentation: 15 degrees.</li>
</ul>

<p>This can be accomplished with the following command (provided <code class="highlighter-rouge">clean4fem</code> is placed into MATLAB path)</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ebsd</span> <span class="o">=</span> <span class="n">clean4fem</span><span class="p">(</span><span class="n">ebsd</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">15.0</span><span class="p">)</span></code></pre></figure>

<p>The changes that the EBSD map undergoes are shown in the figure below.</p>

<figure class="third">
	<a href="https://farm9.staticflickr.com/8768/27648657834_7b4d4bc106_z_d.jpg"><img src="https://farm9.staticflickr.com/8768/27648657834_7b4d4bc106_z_d.jpg" alt="Raw cropped map" /></a>
	<a href="https://farm9.staticflickr.com/8596/27648657864_59fb769ac1_z_d.jpg"><img src="https://farm9.staticflickr.com/8596/27648657864_59fb769ac1_z_d.jpg" alt="Map with bad pixels removed" /></a>
	<a href="https://farm8.staticflickr.com/7619/27983176050_dd0da6d1f7_z_d.jpg"><img src="https://farm8.staticflickr.com/7619/27983176050_dd0da6d1f7_z_d.jpg" alt="Cleaned and filled map" /></a>
	<figcaption>Changes of the EBSD map that takes place in clean4fem: i) raw cropped data, ii) "bad" pixels removed, iii) filled missing and removed pixels.</figcaption>
</figure>

<p>Looks like our cleaning routine did not produce significant artifacts (at least in terms of the phase distribution) and resulted in a reasonable final EBSD map so that we can move on to mesh generation.</p>

<h3 id="mesh-generation-1">Mesh generation</h3>

<p>Now our EBSD data is ready for mesh generation, which, after <a href="(https://github.com/latmarat/ebsd2abaqus/archive/master.zip)">downloading</a> <code class="highlighter-rouge">ebsd2abaqus</code> script, is as simple as</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ebsd2abaqus</span><span class="p">(</span><span class="n">ebsd</span><span class="p">,</span><span class="nb">angle</span><span class="p">)</span></code></pre></figure>

<p>where, again, <code class="highlighter-rouge">angle</code> is the disorientation angle in degrees for grain segmentation, e.g. 15.</p>

<p class="notice"><em><strong>Caveat</strong></em>: pass the segmentation angle without <code class="highlighter-rouge">degree</code> variable, i.e. for angle of 15 the function call is <code class="highlighter-rouge">ebsd2abaqus(ebsd,15.0)</code>, just like in the case of <code class="highlighter-rouge">clean4fem</code> function.</p>

<h3 id="data-checks-in-ebsd2abaqus">Data checks in <code class="highlighter-rouge">ebsd2abaqus</code></h3>

<p>An important thing to keep in mind is that the script performs two checks of the data</p>

<ol>
  <li>Whether or not EBSD is on hexagonal grid</li>
  <li>Whether or not EBSD has non-indexed pixels</li>
</ol>

<p>If any of these conditions are true, the script will call MTEX function <code class="highlighter-rouge">fill</code> to convert the data to a square grid or to fill the non-indexed pixels. The script will inform the user if the <code class="highlighter-rouge">fill</code> function was used and which of the conditions (grid or non-indexed pixels) was the reason.</p>

<p>For example, despite cleaning with <code class="highlighter-rouge">clean4fem</code> function, our EBSD map of forsterite still had some non-indexed pixels at the corners of the map and <code class="highlighter-rouge">ebsd2abaqus</code> displayed the following warning message</p>

<p><code class="highlighter-rouge">
WARNING! EBSD had 54 non-indexed pixels and so was filled using fill function
</code></p>

<p>Since it is only 54 pixels located at the corners, the final EBSD map should be fine and we can use the generated mesh for simulations. However if there are many non-indexed pixels (e.g. when the script is used without prior cleaning), it is better to check if the EBSD map after filling does not have significant artifacts.</p>

<p>Similarly, if we feed an EBSD map measured on hexagonal grid to <code class="highlighter-rouge">ebsd2abaqus</code>, the script will automatically convert it to a square grid using the same <code class="highlighter-rouge">fill</code> function and show a warning:</p>

<p><code class="highlighter-rouge">
WARNING! EBSD was on hex grid and so was converted to sqr grid using fill function
</code></p>

<p>If this is the case, again, it is worth checking if the use of <code class="highlighter-rouge">fill</code> function does not lead to significant distortions in the EBSD data.</p>

<h3 id="the-mesh-in-abaquscae">The mesh in ABAQUS/CAE</h3>

<p>The generated <code class="highlighter-rouge">ebsd.inp</code> contains the following</p>

<ul>
  <li>Mesh (nodes and elements)</li>
  <li>Element Sets for grains and phases</li>
  <li>Sections for phases</li>
</ul>

<p>In ABAQUS/CAE, the generated mesh consisting of 30,744 C3D8 elements looks as shown below.</p>

<figure class="third">
	<a href="https://farm9.staticflickr.com/8768/27648657834_7b4d4bc106_z_d.jpg"><img src="https://farm9.staticflickr.com/8768/27648657834_7b4d4bc106_z_d.jpg" alt="Raw cropped map" /></a>
	<a href="https://farm8.staticflickr.com/7619/27983176050_dd0da6d1f7_z_d.jpg"><img src="https://farm8.staticflickr.com/7619/27983176050_dd0da6d1f7_z_d.jpg" alt="Cleaned and filled map" /></a>
	<a href="https://farm9.staticflickr.com/8566/28187499371_0ba97f5602_z_d.jpg"><img src="https://farm9.staticflickr.com/8566/28187499371_0ba97f5602_z_d.jpg" alt="Map with bad pixels removed" /></a>
	<figcaption>The final mesh in ABAQUS/CAE color-coded according to phase sets (iii) alongside with the raw EBSD map (i) and the cleaned EBSD map (ii).</figcaption>
</figure>

<p>Whereas the model tree in ABAQUS/CAE looks like this:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Parts
└── SAMPLE
    └── Sets
    	├── ALLELEMENTS           <span class="c"># Element set containing all the elements</span>
    	├── ALLNODES              <span class="c"># Node set containing all the nodes</span>
    	├── GRAIN-1               <span class="c"># Element set constituting GRAIN-1</span>
    	├── GRAIN-2               <span class="c"># Element set constituting GRAIN-2</span>
    	├── ...                   <span class="c"># etc.</span>
    	├── NODES+1               <span class="c"># Node set containing nodes on the face of +X</span>
    	├── NODES+2               <span class="c"># Node set containing nodes on the face of +Y</span>
    	├── NODES+3               <span class="c"># Node set containing nodes on the face of +Z</span>
    	├── ...                   <span class="c"># etc.</span>
    	├── PHASE-DIOPSIDE        <span class="c"># Element set constituting phase diopside</span>
    	├── PHASE-ENSTATITE       <span class="c"># Element set constituting phase enstatite</span>
    	└── PHASE-FORSTERITE      <span class="c"># Element set constituting phase forsterite</span>
Materials                         <span class="c"># Create materials with phase names as material names</span>
Sections                          <span class="c"># Sections for phases</span>
	├── Section-1-PHASE-FORSTERITE
	├── Section-2-PHASE-ENSTATITE
	└── Section-3-PHASE-DIOPSIDE

Step                              <span class="c"># Create step, BCs, etc.</span>
...</code></pre></figure>

<p>The sections for phases are created assuming that there will be a material for each phase so that for this model we need to create three materials: <em>Forsterite</em>, <em>Enstatite</em>, and <em>Diopside</em> with the desired properties. Finally once we define all the other ingredients – step, boundary conditions, output, we are ready to run the microstructure-based simulations!</p>

<h1 id="citation">Citation</h1>

<p>The script presented here is a by-product of one of my short-term research projects – on medium manganese steel – while I was at POSTECH. You can find the publication resulting from this project (and showing <code class="highlighter-rouge">ebsd2abaqus</code> in action) <a href="https://dx.doi.org/10.1016/j.actamat.2016.02.001">here</a>. Feel free to cite the paper (or even this post) if you like.</p>

<p>Bibtex entry:</p>

<figure class="highlight"><pre><code class="language-latex" data-lang="latex">@article
<span class="p">{</span>Latypov2016,
author = <span class="p">{</span>Latypov, M.I. and Shin, S. and <span class="p">{</span>De Cooman<span class="p">}</span>, B.C. and Kim, H.S.<span class="p">}</span>,
doi = <span class="p">{</span>10.1016/j.actamat.2016.02.001<span class="p">}</span>,
issn = <span class="p">{</span>13596454<span class="p">}</span>,
journal = <span class="p">{</span>Acta Materialia<span class="p">}</span>,
keywords = <span class="p">{</span>Finite element methods,Medium Mn steel,Strain partitioning,TWIP+TRIP<span class="p">}</span>,
pages = <span class="p">{</span>219--228<span class="p">}</span>,
title = <span class="p">{</span> <span class="p">{</span>Micromechanical finite element analysis of strain partitioning in multiphase medium manganese TWIP+TRIP steel<span class="p">}</span> <span class="p">}</span>,
volume = <span class="p">{</span>108<span class="p">}</span>,
year = <span class="p">{</span>2016<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h1 id="acknowledgements">Acknowledgements</h1>

<p>Thanks are due to Ralf Hielscher for <a href="https://groups.google.com/d/msg/mtexmail/MPG0SffjR6o/z1vmzHEyCAAJ">explanations</a> on grid checks and conversion.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#mtex" title="Pages tagged mtex" class="tag"><span class="term">mtex</span></a><a href="/tags/#abaqus" title="Pages tagged abaqus" class="tag"><span class="term">abaqus</span></a><a href="/tags/#matlab" title="Pages tagged matlab" class="tag"><span class="term">matlab</span></a><a href="/tags/#ebsd" title="Pages tagged ebsd" class="tag"><span class="term">ebsd</span></a><a href="/tags/#microstructures" title="Pages tagged microstructures" class="tag"><span class="term">microstructures</span></a></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2016-07-12">July 12, 2016</time></span></span>
        <span class="author vcard"><span class="fn">Marat I. Latypov</span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/slides/research-july-2016/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/emi-info/" title="My talk on quantification of EBSD datasets">My talk on quantification of EBSD datasets</a></h3>
      <p>Slides presented at EMI-2016 conference (Metz, France), October 2016. <a href="/emi-info/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/slides/emi-slides/" title="EBSD data analytics for quantification of UFG microstructures">EBSD data analytics for quantification of UFG microstructures</a></h4>
        <span>Published on November 14, 2016</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="/ppt2reveal/" title="How to make an easy transition from PowerPoint to reveal.js">How to make an easy transition from PowerPoint to reveal.js</a></h4>
        <span>Published on August 26, 2016</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Marat I. Latypov. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61278008-2', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'latmarat'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</body>
</html>
